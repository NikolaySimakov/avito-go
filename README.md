# Avito Go Task

Требуется реализовать сервис, хранящий пользователя и сегменты, в которых он состоит (создание, изменение, удаление сегментов, а также добавление и удаление пользователей в сегмент).

Для запуска сервиса:
- Переименуйте .env.example в .env, укажите все необходимые переменные
- Запустите файл `migrations/create_tables.sql`, чтобы создать все необходимые таблицы.

Запустите приложение:

```
go run cmd/main.go
```

## Usage

Основные HTTP запросы к серверу:

### POST: /segment/ - добавить сегмент

```json
{
    "slug": "AVITO_VOICE_MESSAGES"
}
```

Сервер вернет такой же респонс.

### DELETE: /segment/ - удалить сегмент

```json
{
    "slug": "AVITO_VOICE_MESSAGES"
}
```

### POST: /user/

Отвечает за добавление и удаление пользователя в сегменты.

```json
{
    "user_id": "1000",
    "add_segments": ["SEGMENT_1", "SEGMENT_2"],
    "delete_segments": ["SEGMENT_3"]
}
```

### GET: /user/

Возвращает сегменты пользователя.

```json
{
    "user_id": "1000"
}
```

Респонс:

```json
[
    "SEGMENT_1",
    "SEGMENT_2"
]
```


### POST: /user/

Пример использования ограничителя времени из второго задания. Пользователь с данным ID будет добавлен в указанный сегмент с TTL:

```json
{
    "user_id": "1000",
    "add_segments": ["SEGMENT_1"],
    "delete_segments": [],
    "ttl": 2
}
```

Дедлайн в данном JSON запросе установлен на 2 минуты. Чтобы убедиться, что данные исчезнут по истечении срока, воспользуйтесь:

GET: /user/

```json
{
    "user_id": "1000"
}
```


## Endpoints

- POST: `/segment/` - adding segment by slug
- DELETE: `/segment/` - delete segment by slug

- GET: `/user/` - get all segments by userId
- POST: `/user/` - add and delete user from segments

## TODO

- [x] Метод создания сегмента. Принимает slug (название) сегмента.
- [x] Метод удаления сегмента. Принимает slug (название) сегмента.
- [x] Метод добавления пользователя в сегмент. Принимает список slug (названий сегментов которые нужно добавить пользователю, список slug (названий) сегментов которые нужно удалить у пользователя, id пользователя.
- [x] Метод получения активных сегментов пользователя. Принимает на вход id пользователя.

### ✅ Доп. задание 2

Бывают ситуации когда нам нужно добавить пользователя в эксперимент на ограниченный срок. Например выдать скидку всего на 2 дня.

Задача: реализовать возможность задавать TTL (время автоматического удаления пользователя из сегмента)

Пример: Хотим чтобы пользователь попал в сегмент на 2 дня - для этого в метод добавления сегментов пользователю передаём время удаления пользователя из сегмента отдельным полем